
local fileContent = "ACTIVE"
if not isfile("ALAUTOFARM.txt") then
	writefile("ALAUTOFARM.txt", "ACTIVE")
	fileContent = "ACTIVE"
else
	fileContent = readfile("ALAUTOFARM.txt")
end
print("LOADING")
repeat wait()
until game:IsLoaded()
print("STARTING")
if _G.ALAUTOFARM then
    print("ALREADY STARTED")
    return
end

_G.ALAUTOFARM = true
local vipPlaceId = 85547073091480
local PlaceId = game.PlaceId

local function queueTP()
	local success,result = pcall(function()
		queue_on_teleport("loadstring(game:HttpGet('https://raw.githubusercontent.com/c345g/a/refs/heads/main/baanaaana'))()")
		print("queued TP")
	end)
	if not success then
		print("queue failed: "..result)
	end
end
queueTP()


game:GetService("UserInputService").InputBegan:Connect(function(key,proc)
    if proc then return end
    if key.KeyCode == Enum.KeyCode.LeftBracket then
        if fileContent == "INACTIVE" then
            writefile("ALAUTOFARM.txt", "ACTIVE")
			fileContent = "ACTIVE"
        else
            writefile("ALAUTOFARM.txt", "INACTIVE")
			fileContent = "INACTIVE"
            game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "Disabled!",
                    Text = "Disable Farm"
            })
        end
	else if key.KeyCode == Enum.KeyCode.RightBracket then
		queueTP()
                pcall(function()
                    game:GetService("TeleportService"):Teleport(vipPlaceId, game.Players.LocalPlayer)
                    game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "Teleporting!",
                    Text = "MOVING TO PROS!!!"
                })
                end)
    end
end)

print("Checking for stoppage")
if fileContent == "INACTIVE" then
	print("STOPPED")
    while task.wait(.5) do
        if fileContent == "ACTIVE" then
            game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "Activated!",
                    Text = "Activated Farm"
            })
            break
		else
			 game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "Farm is disabled",
                    Text = "!!!!!"
            })
        end
    end
end

local VirtualInputManager = game:GetService("VirtualInputManager")

    local function clickButton(button)
    button.AnchorPoint = Vector2.new(0,0)
    local guiInset = game:GetService("GuiService"):GetGuiInset()
    local pos = button.AbsolutePosition
    local size = button.AbsoluteSize
    local x = (pos.X + size.X / 2) + guiInset.X
    local y = (pos.Y + size.Y / 2) + guiInset.Y
    VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
    task.wait()
    VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
    end

    local function blockRandom()
        
        local playerList = game.Players:GetPlayers()
        local randomPlayer = nil

        repeat randomPlayer = playerList[math.random(1,#playerList)]
            task.wait()
        until randomPlayer and randomPlayer ~= game.Players.LocalPlayer
        
        repeat 
        game:GetService("StarterGui"):SetCore("PromptBlockPlayer",randomPlayer)
        task.wait()
        until game:GetService("CoreGui"):FindFirstChild("BlockingModalScreen")
        task.wait()
        repeat
            pcall(function() 
            clickButton(game:GetService("CoreGui").BlockingModalScreen.BlockingModalContainer.BlockingModalContainerWrapper.BlockingModal.AlertModal.AlertContents.Footer.Buttons["3"])
            end)
            task.wait()
        until not game:GetService("CoreGui"):FindFirstChild("BlockingModalScreen")
    end


local function newServer()
        coroutine.wrap(function()
            while true do
				queueTP()
                pcall(function()
                    game:GetService("TeleportService"):Teleport(PlaceId, game.Players.LocalPlayer)
                    game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "Teleporting!",
                    Text = "NEW SERVER"
                })
                end)
                task.wait(1)
            end
        end)()
end

print("Getting Blocked Players")
local blockedIds = game:GetService("StarterGui"):GetCore("GetBlockedUserIds")

local foundBlocked = false
for i,plr in game.Players:GetPlayers() do
    if table.find(blockedIds,plr.UserId) then
        foundBlocked = true
        game:GetService("StarterGui"):SetCore("PromptUnblockPlayer",game.Players:GetPlayerByUserId(plr.UserId))
        repeat task.wait()
        until game:GetService("CoreGui").RobloxGui.PromptDialog.Visible == true 
        repeat
            pcall(function()
                clickButton(game:GetService("CoreGui").RobloxGui.PromptDialog.ContainerFrame.ConfirmButton)
            end)
		task.wait()
        until game:GetService("CoreGui").RobloxGui.PromptDialog.Visible == false
    end
end

if foundBlocked then
    newServer()
end
print("Detecting Kick")
game:GetService("CoreGui").RobloxPromptGui.promptOverlay.ChildAdded:Connect(function(v)
    if v.Name == "ErrorPrompt" then
        newServer()
    end
end)
if game:GetService("CoreGui").RobloxPromptGui.promptOverlay:FindFirstChild("ErrorPrompt") then
    newServer()
end


local escape = CFrame.new(Vector3.new(-35, 520, 500))
local escape2 = CFrame.new(Vector3.new(-2, 505, 458))
local safe = CFrame.new(Vector3.new(0,520,537))
print("Setting first coroutine")
    local toolong = false
    coroutine.wrap(function()
        task.wait(3)
        toolong = true
        task.wait(25)
        newServer()
    end)()
print("Starting loading player")
    repeat 
    pcall(function()   
    local r = game:GetService("ReplicatedStorage").Remote.TeamChange:InvokeServer(game:GetService("Teams").PATIENT,"Patient")
    if r then 
        game:GetService("ReplicatedStorage").Remote.AnalyticsEvent:FireServer("Funnel","Title Screen","Selected Team") 
    end
    end)
    if game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        pcall(function()
			game.Players.LocalPlayer.Character:PivotTo(safe)
		end)
    end
    if toolong then
        break
    end
    task.wait(.05)
    until game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and game.Players.LocalPlayer:GetAttribute("CharacterLoaded")
    local escapeNum = game.Players.LocalPlayer.Configuration_Statistics:GetAttribute("Escapes")
print("Starting Character TP")
    coroutine.wrap(function()
        repeat
pcall(function()
    game.Players.LocalPlayer.Character:PivotTo(escape)
end)
    task.wait(.05)
    until game.Players.LocalPlayer:GetAttribute("IsEscaping") == true and escapeNum < game.Players.LocalPlayer.Configuration_Statistics:GetAttribute("Escapes")
    game.Players.LocalPlayer.Character:PivotTo(escape2)
	print("Done!!!")
    pcall(function()
        coroutine.wrap(function()
            blockRandom()
        end)()
    end)
    coroutine.wrap(function()
        local message = {
    ["content"] = "@everyone ```***ASYLUM!!!***\nServer: "..game.JobId.."\nEscapes:"..game.Players.LocalPlayer.Configuration_Statistics:GetAttribute("Escapes").."\nMunyun: "..game.Players.LocalPlayer.Configuration_Statistics:GetAttribute("Points").."\nLevel: "..game.Players.LocalPlayer:GetAttribute("CurrentTeamLevel").."\nEXP: "..game.Players.LocalPlayer:GetAttribute("CurrentTeamExp").."\nTime: "..os.date().."```"
}

local params = {
    Url = "https://discord.com/api/webhooks/1193502946671988829/a8bFrZq1Ai4LBeFcXP9k--YpEYJWiZT9w3owpP9WD00lBq43CB9aZd1IJGAPVym35xYD",
    Method = "POST",
    Headers = {
            ["Content-Type"] = "application/json"  -- When sending JSON, set this!
        },
    Body = game:GetService("HttpService"):JSONEncode(message)
}

pcall(function()
    request(params)
end)
    end)()
    task.wait(1)
    newServer()
    end)()
    task.wait(3)
    game.Players.LocalPlayer:SetAttribute("IsEscaping",true)
    escapeNum = -1
